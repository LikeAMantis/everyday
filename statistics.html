<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="logo.png">
    <link rel="stylesheet" href="index.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
    <title>Statistics</title>
    <style>
        body {
            display: flex;
            flex-wrap: wrap;
            flex-direction: row;
            align-items: center;
            justify-content: space-evenly;
            gap: 75px;
        }
        .Chart-Container {
            width: 700px;
            height: 900px;
            text-align: center;
            font-size: 16pt;
            font-weight: 500;
            line-height: 29pt;
        }
    </style>
</head>
<body>
    <div class="Chart-Container">
        Done & Longest Streak
        <canvas id="absoluteChart" ></canvas>
    </div>
    <div class="Chart-Container">
        Comparison
        <canvas id="relativeChart" ></canvas>
    </div>
</body>
<script>
    var categories = [{"name":"Meditation","color":"blue","dates":{"2021-9-22":"done","2021-9-21":"done","2021-9-20":"done","2021-9-19":"done","2021-9-23":"done","2021-9-24":"done","2021-9-25":"done","2021-9-26":"done","2021-9-28":"done","2021-9-29":"done","2021-9-30":"done","2021-10-1":"done","2021-10-2":"done","2021-10-3":"done","2021-10-4":"done","2021-10-5":"done","2021-10-6":"done","2021-10-7":"done","2021-10-8":"done","2021-10-9":"done","2021-10-10":"done","2021-10-11":"done","2021-10-12":"done","2021-10-13":"done"},"longestStreak":16},{"name":"Training","color":"green","dates":{"2021-9-19":"done","2021-9-20":"done","2021-9-21":"done","2021-9-22":"done","2021-9-23":"done","2021-9-27":"done","2021-9-28":"done","2021-9-29":"done","2021-9-30":"done","2021-10-1":"done","2021-10-2":"done","2021-10-3":"done","2021-10-4":"done","2021-10-5":"done","2021-10-6":"done","2021-10-7":"skip","2021-10-8":"done","2021-10-9":"done","2021-10-10":"done","2021-10-11":"done","2021-10-12":"done","2021-9-24":"done","2021-10-13":"done"},"longestStreak":16},{"name":"MVD","color":"red","dates":{"2021-9-20":"done","2021-9-22":"done","2021-9-24":"done","2021-9-29":"done","2021-9-30":"done","2021-10-1":"done","2021-10-3":"done","2021-10-4":"done","2021-10-5":"done","2021-10-6":"done","2021-10-7":"done","2021-10-8":"done","2021-10-9":"skip","2021-10-10":"done","2021-10-11":"done","2021-10-12":"done","2021-10-13":"done","2021-9-21":"done","2021-10-2":"done","2021-9-25":"done","2021-9-19":"done","2021-9-23":"skip","2021-9-26":"done","2021-9-27":"done"},"longestStreak":14},{"name":"Reading","color":"teal","dates":{"2021-9-26":"done","2021-9-27":"done","2021-9-29":"done","2021-9-30":"done","2021-10-1":"done","2021-10-4":"done","2021-10-5":"done","2021-10-6":"done","2021-10-7":"done","2021-10-8":"done","2021-10-9":"done","2021-10-10":"done","2021-10-11":"done","2021-10-12":"done","2021-9-20":"done","2021-9-21":"done","2021-9-22":"done","2021-9-23":"done","2021-9-24":"done","2021-9-28":"done","2021-10-2":"done"},"longestStreak":9},{"name":"Go for a walk","color":"purple","dates":{"2021-9-19":"done","2021-9-20":"done","2021-9-21":"done","2021-9-22":"done","2021-9-23":"done","2021-9-24":"done","2021-9-26":"done","2021-9-27":"done","2021-9-28":"done","2021-9-29":"done","2021-10-1":"done","2021-10-2":"done","2021-10-5":"done","2021-10-6":"done","2021-10-7":"skip","2021-10-8":"done","2021-10-10":"done","2021-10-11":"done","2021-10-12":"done","2021-10-9":"done","2021-9-30":"done","2021-10-3":"done"},"longestStreak":7},{"name":"Learning","color":"orange","dates":{"2021-9-20":"done","2021-9-21":"done","2021-9-22":"done","2021-9-24":"done","2021-9-27":"done","2021-10-4":"done","2021-10-3":"done","2021-9-30":"done","2021-10-1":"done","2021-10-2":"done","2021-9-23":"done","2021-10-9":"done","2021-10-10":"done","2021-10-11":"done","2021-10-12":"done","2021-10-13":"done","2021-10-8":"done","2021-9-26":"done","2021-10-6":"done","2021-10-7":"done","2021-9-25":"done","2021-10-5":"skip","2021-9-28":"done"},"longestStreak":13}];
    var categoriesAbsolute = categories.map(x => Object.values(x.dates)).map(x => x.filter(x => x == "done").length);
    var total = categoriesAbsolute.reduce((x, y) => x + y);
    var longestStreaks = categories.map(x => x.longestStreak);

    Chart.defaults.color ='white';
    Chart.defaults.scale.grid.color = "grey";




    var ctx = document.getElementById('absoluteChart').getContext('2d');
    var absoluteChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: categories.map(x => x.name),
        datasets: [
            {
                label: 'Done',
                data: categoriesAbsolute,
                backgroundColor: categories.map(categorie => getComputedStyle(document.documentElement).getPropertyValue(`--${categorie.color}`)),
                borderColor: [
                    'black',
                ],
                borderWidth: 1
            },
            {
                label: 'Longest Streak',
                data: longestStreaks,
                backgroundColor: ["black"],
                borderColor: [
                    'white',
                ],
                borderWidth: 0
            }
        ]
    },
    options: {
        // animation: {
        //     duration: 0,
        // },
        scales: {
            y: {
                beginAtZero: true
            }
        },
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false,
            },
        },
    }
});




var ctx2 = document.getElementById('relativeChart').getContext('2d');
var relativeChart = new Chart(ctx2, {
    type: 'doughnut',
    data: {
        labels: categories.map(x => x.name),
        datasets: [{
            label: '%',
            data: categoriesAbsolute.map(x => Math.round(x / total * 100)),
            backgroundColor: categories.map(categorie => getComputedStyle(document.documentElement).getPropertyValue(`--${categorie.color}`)),
            borderColor: [
                'black',
            ],
            borderWidth: 1
        }]
    },
    options: {
        // animation: {
        //     duration: 0,
        // },
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return `${context.label}: ${context.formattedValue + context.dataset.label}`;
                    }
                }
            },
            legend: {
                onClick: updateRatio,
            }
        }
    }
});

var pieDoughnutLegendClickHandler = Chart.controllers.doughnut.overrides.plugins.legend.onClick;
var copy = categoriesAbsolute.map(x => x);
function updateRatio(e, legendItem, legend) {
    var index = legendItem.index;
    
    if (legendItem.hidden) {
        copy[index] = categoriesAbsolute[index];
    } else {
        copy[index] = 0;
    }
    e.chart.config._config.data.datasets[0].data = copy.map(x => Math.round(x / copy.reduce((x, y) => x + y) * 100));
    
    pieDoughnutLegendClickHandler(e, legendItem, legend);
};
</script>
</html>